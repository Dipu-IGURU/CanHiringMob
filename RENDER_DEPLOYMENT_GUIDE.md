# üöÄ Render Deployment Guide for CanHiring Backend

## üìã Prerequisites

1. **GitHub Repository**: Your code should be pushed to GitHub
2. **Render Account**: Sign up at [render.com](https://render.com)
3. **MongoDB Database**: Either MongoDB Atlas (cloud) or Render's built-in database

## üéØ Step-by-Step Deployment

### Step 1: Prepare Your Repository

1. **Push your code to GitHub** (if not already done):
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

2. **Verify your files are in place**:
   - ‚úÖ `render.yaml` (in root directory)
   - ‚úÖ `server/package.json`
   - ‚úÖ `server/server.js`
   - ‚úÖ `server/env.render.example`

### Step 2: Create Render Account & Connect GitHub

1. Go to [render.com](https://render.com) and sign up
2. Connect your GitHub account
3. Authorize Render to access your repositories

### Step 3: Deploy Backend Service

#### Option A: Using render.yaml (Recommended)

1. **Create New Web Service**:
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository
   - Select your repository: `CanHiringMob/CanHiringMob`

2. **Configure Service**:
   - **Name**: `canhiring-backend`
   - **Environment**: `Node`
   - **Build Command**: `cd server && npm install`
   - **Start Command**: `cd server && npm start`
   - **Plan**: Free (or paid if you need more resources)

3. **Environment Variables**:
   ```
   NODE_ENV=production
   PORT=10000
   JWT_SECRET=your-super-secret-jwt-key-here
   JWT_EXPIRE=7d
   ```

4. **Database Setup**:
   - **Option 1**: Use Render's built-in database (free)
     - Click "New +" ‚Üí "PostgreSQL" or "MongoDB"
     - Name: `canhiring-db`
     - Plan: Free
   - **Option 2**: Use MongoDB Atlas (recommended for production)
     - Create account at [mongodb.com](https://mongodb.com)
     - Create a cluster
     - Get connection string
     - Add to environment variables: `MONGODB_URI=mongodb+srv://...`

#### Option B: Manual Configuration

1. **Create Web Service**:
   - Click "New +" ‚Üí "Web Service"
   - Connect GitHub repository
   - Select repository

2. **Manual Settings**:
   - **Root Directory**: `server`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Environment**: `Node`

### Step 4: Configure Environment Variables

Add these environment variables in Render dashboard:

```bash
# Required
NODE_ENV=production
PORT=10000
JWT_SECRET=your-very-long-and-secure-jwt-secret-key-here
JWT_EXPIRE=7d

# Database (choose one)
# Option 1: Render Database (auto-generated)
MONGODB_URI=postgresql://... (auto-generated by Render)

# Option 2: MongoDB Atlas
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/canhiring?retryWrites=true&w=majority
```

### Step 5: Deploy and Test

1. **Deploy**:
   - Click "Create Web Service"
   - Wait for deployment to complete (5-10 minutes)

2. **Test Your API**:
   ```bash
   # Health check
   curl https://your-service-name.onrender.com/api/health
   
   # Mobile health check
   curl https://your-service-name.onrender.com/api/mobile/health
   ```

3. **Get Your API URL**:
   - Your API will be available at: `https://your-service-name.onrender.com`
   - API endpoints: `https://your-service-name.onrender.com/api/...`

## üîß Update Your Mobile App

### Update API Configuration

1. **Update `src/config/environment.js`**:
   ```javascript
   const API_CONFIG = {
     production: 'https://your-service-name.onrender.com',
     development: {
       web: 'http://localhost:5001',
       mobile: 'http://192.168.1.28:5001'
     }
   };
   ```

2. **Update environment variables**:
   ```bash
   # In your .env file
   EXPO_PUBLIC_API_BASE_URL=https://your-service-name.onrender.com
   ```

3. **Test the connection**:
   ```bash
   # Test from your mobile app
   curl https://your-service-name.onrender.com/api/health
   ```

## üõ†Ô∏è Troubleshooting

### Common Issues

1. **Build Fails**:
   - Check if `server/package.json` exists
   - Verify Node.js version compatibility
   - Check build logs in Render dashboard

2. **Database Connection Issues**:
   - Verify `MONGODB_URI` is correct
   - Check if database is accessible from Render
   - Ensure database user has proper permissions

3. **CORS Issues**:
   - Check CORS configuration in `server/server.js`
   - Verify allowed origins include your domain
   - Test with Postman or curl first

4. **Service Keeps Restarting**:
   - Check logs for errors
   - Verify all environment variables are set
   - Check if port is correctly configured

### Debug Commands

```bash
# Check service logs
# Go to Render dashboard ‚Üí Your Service ‚Üí Logs

# Test API endpoints
curl -X GET https://your-service-name.onrender.com/api/health
curl -X POST https://your-service-name.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password"}'
```

## üì± Mobile App Integration

### Update Your App Configuration

1. **Update API Base URL**:
   ```javascript
   // In src/config/environment.js
   export const API_BASE_URL = 'https://your-service-name.onrender.com';
   ```

2. **Test Login**:
   - Try logging in with your mobile app
   - Check if network requests are successful
   - Verify token generation and storage

3. **Update CORS** (if needed):
   - Add your mobile app's bundle identifier to allowed origins
   - Or ensure "no origin" requests are allowed (for mobile apps)

## üéâ Success Checklist

- [ ] Backend deployed successfully on Render
- [ ] Database connected and working
- [ ] API health check returns success
- [ ] Mobile app can connect to backend
- [ ] Login/register functionality works
- [ ] All API endpoints respond correctly
- [ ] CORS configured properly
- [ ] Environment variables set correctly

## üîÑ Continuous Deployment

Once set up, Render will automatically deploy when you push to your main branch:

```bash
git add .
git commit -m "Update backend"
git push origin main
# Render will automatically deploy the changes
```

## üìû Support

If you encounter issues:

1. Check Render service logs
2. Verify environment variables
3. Test API endpoints manually
4. Check database connectivity
5. Review CORS configuration

Your backend should now be live at: `https://your-service-name.onrender.com` üöÄ
